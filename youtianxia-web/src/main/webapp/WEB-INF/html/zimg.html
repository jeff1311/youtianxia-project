<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>zimg test</title>
    <style>
        #show{
            width:200px;
        }
    </style>
</head>
<body>
<input type="file" id="upfile" name="userfile">
<button id="upload">上传</button>
<img id="show" >
</body>
<script type="text/javascript">
//原生JS版ajax文件上传（和zimg交互）
document.getElementById("upload").onclick = function() {
	//文件ID
	var fileId = "upfile";
	//上传地址
  	var url = "http://47.97.113.145:4860/upload";
	//创建ajax对象 
	var ajax = new XMLHttpRequest();
	//创建FormData（表单数据类）
	var fd = new FormData();
	//把文件添加到表单里
	fd.append("userfile", document.getElementById(fileId).files[0]);
	//创建请求
	ajax.open("post", url, true);
	//发送请求
	ajax.send(fd);
	//请求成功回调（ajax.readyState == 4 && ajax.status == 200）
	ajax.onload = function () {
		console.log(ajax.readyState);
		console.log(ajax.status);
	  	var data = JSON.parse(ajax.responseText);
	  	if(data.ret == true){
	  		var info = data.info;
		 　    console.log(info.md5);
		    alert('上传成功');
			//document.getElementById('show').src = 'http://47.97.113.145:4860/files/img/' + info.md5 + '?w=200&h=200';
	  	}else{
	  		alert('上传失败');
	  	}
	};
	//注册事件 onreadystatechange 状态改变就会调用
	/* ajax.onreadystatechange = function () {
	if (ajax.readyState == 4 && ajax.status == 200) {
	   	var data = JSON.parse(ajax.responseText);
	   	if(data.ret == true){    		
	    	var info = data.info;
	   	}
　　	}
	} */ 
}

//上传图片预览
document.getElementById('upfile').onchange = function(){
    var re = new FileReader();
    re.readAsDataURL(this.files[0]);
    re.onload = function(){
        document.getElementById('show').src = re.result;
    }
}

</script>
</html>